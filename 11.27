#define _CRT_SECURE_NO_DEPRECATE
#include <stdio.h>
#include <math.h>
#include <locale.h>

// Эталонная функция Y(x)
double Y(double x) {
    return exp(cos(x)) * cos(sin(x));
}

// Приближение S(x) через сумму ряда с точностью epsilon
double S(double x, double epsilon) {
    double sum = 0.0;
    double factorial = 1.0;  // k! для k=0
    double term;
    int k = 0;

    do {
        if (k > 0) {
            factorial *= k;  // вычисляем k! итеративно
        }
        term = cos(k * x) / factorial;
        sum += term;
        k++;
    } while (fabs(term) > epsilon);

    return sum;
}

int main() {
    setlocale(LC_ALL, "rus");
    double a, b, dx, n;

    // Ввод параметров
    printf("Введите начало интервала a: ");
    scanf("%lf", &a);
    printf("Введите конец интервала b (b > a): ");
    scanf("%lf", &b);
    printf("Введите шаг dx (dx > 0): ");
    scanf("%lf", &dx);
    printf("Введите n (число членов ряда): ");
    scanf("%lf", &n);

    // Проверка корректности ввода
    if (b <= a || dx <= 0 || n <= 0) {
        printf("Ошибка: неверные параметры интервала или точности.\n");
        return 1;
    }

    // Заголовок таблицы
    printf("\nТаблица значений и погрешностей\n");
    printf("-------------------------------------------------------------\n");
    printf("   x    |   Y(x)    |   S(x)    | Абс. погр. | Отн. погр. (%)\n");
    printf("-------------------------------------------------------------\n");

    // Вычисление и вывод значений по шагам
    for (double x = a; x <= b; x += dx) {
        double Y_val = Y(x);
        double S_val = S(x, n);

        // Абсолютная погрешность
        double abs_error = fabs(Y_val - S_val);

        // Относительная погрешность (с защитой от деления на ноль)
        double rel_error = 0.0;
        if (fabs(Y_val) > 1e-12) {  // порог для "почти нуля"
            rel_error = (abs_error / fabs(Y_val)) * 100.0;
        }
        else {
            rel_error = NAN;  // не определено
        }

        // Вывод строки таблицы
        if (!isnan(rel_error)) {
            printf("%7.3f | %9.6f | %9.6f | %e | %e\n",
                x, Y_val, S_val, abs_error, rel_error);
        }
        else {
            printf("%7.3f | %9.6f | %9.6f | %10.6f |      N/A\n",
                x, Y_val, S_val, abs_error);
        }
    }

    return 0;
}
